## Disclaimer
НЕ лезьте в код с целью подсмотреть как работает тот или определённый механ с целью получения игрового преимущества, это разрушает всю идею исследования
НЕ распростроняйте информацию о работе аномалий и прочего в общих чатах, это тоже очень плохо влияет на восприятие!

# WIP Документация в процессе написания! WIP

Данная папка - documentation - будет содержать в себе различную документацию,пояснялки и блок схемы.

## Небольшая карта мода:
[Аномалии] - [mods\anomaly\code\anomalies]

[Артефакты]- [mods\anomaly\code\artifacts]

[Оборудование_и_снаряжение] - [mods\anomaly\code\detectors_and_etc]

[Спавн_аномалий_и_их_размещение_игры] - [mods\anomaly\code\spawn_anomalies_protocol]

[Погода] - [mods\anomaly\code\monitor_effects]

[Админ_билдер_аномалий] - [mods\anomaly\code\anomaly_admin.dm]

[Сабсистема_аномалий] - [mods\anomaly\code\anomaly_controller.dm]

## Аномалии
Вся ИДЕЯ аномалий взята с сервера Ашан, Сталкер, пикник на обочине, реализация - своя.
Игромеханически, аномалии можно сравнить с сапёром, т.к геймплей больше похож именно на это.
-Аномалия/её вспомогательные части реагируют на пересечение себя какими-либо предметами, обьектами, существами. -В случае если атом(любой обьект) указан в параметрах как ИНИЦИАТОР - аномалия реагирует, т.е ВЗВОДИТСЯ.
-Если аномалия ПРЕДЗАРЯДОЧНАЯ, need_preload, аномалия ждёт время, равное cooldown
-Для всех атомов в радиусе effect_range() выполняется get_effect_by_anomaly()
-После, выполняется handle_activate и аномалия начинает "Считать время" до следующей активации
-После того как аномалия вновь доступна и готова реагировать, мы ещё раз проверяем ядро и вспомогательные части на наличие инициаторов. Если никого нет - код закончен и аномалия больше ничего не просчитывает. Если что-то нашлось - всё по новой, и так пока инициаторов не станет. (Т.е аномалия не успокоится, пока в ней условно будет человек)


## Артефакты
В отличии от артефактов с ашана где крайне много бесполезных артефактов и крайне много артефактов с слишком скрытыми свойствами, где игрок исключительно СЛУЧАЙНО узнает его свойство - артефакты мода ANOMALIES хоть и малочисленны, но обладают множественными эффектами, несколько эффектов являются крайне очевидными и находятся с помощью ИНТЕРАКЦИЙ, намёки на многие находятся через интеракции с URM machine и так же находятся через обычные интеракции, и лишь малая часть - довольно спрятаны и находятся случайно.

Артефакты спавнятся при генерации аномалий через функцию generate_anomalies_in_turfs(), их количество строго ограничено при генерации.

[Постоянное_воздействие_на_носителя]
Артефакты обрабатываются 24/7 подсистемой SSanom, т.к невозможно предугадать кодом все движения артефакта по инвентарям/турфам и т.д
При процессинге раз в довольно большой срок (2-5 секунд) артефакт проверяет, что он всё ещё находится в мобе.
Далее, артефакт оказывает своё постоянное  влияние на носителя - регенерирует стамину, лечит органы, что угодно, это указывается в 
/obj/item/artefact/proc/process_artefact_effect_to_user()
	return

Готовые примеры:
Код для регенерации стамины пользователя:
/obj/item/artefact/gravi/process_artefact_effect_to_user()
	if(current_user.stamina < 85)
		current_user.adjust_stamina(5)
Т.е, если стамина носителя меньше 85 - добавить ему 5 единиц
Меняйте переменную process_effect_cooldown чтоб выбирать, как часто артефакт будет влиять на носителя

[Реакция_артефатков_на_внешнее_событие_с_носителем]
Артефакты могут отслеживать внешние события происходящие с их носителем. Вот как это работает

//У нас есть событие - персонаж проваливается на Z уровень ниже
/mob/living/carbon/human/handle_fall_effect(turf/landing) 
    //Мы вызываем функцию, которая опросит все артефакты находящиеся в инвентаре носителя что ОНИ думают об этом событии
	var/list/result_effects = calculate_artefact_reaction(src, "Падение с высоты")
	if(result_effects)
    //Здесь мы добавляем, какие реакции что делают. Если мы хотим при помощи реакции "Защищает от падения" защитить персонажа от урона с падения - так и пишем.
		if(result_effects.Find("Защищает от падения"))
			return
	.=..()

Всё, теперь артефакт оберегает персонажа от падения с высоты. Тоже самое с ЭМИ ударом.

/mob/living/emp_act(severity)
	var/list/result_effects = calculate_artefact_reaction(src, "ЭМИ")
	if(result_effects)
		if(result_effects.Find("Защищает от ЭМИ"))
			return
	. = ..()

Подробнее в 


## Спавн аномалий и их размещение игры
[mods\anomaly\code\spawn_anomalies_protocol] <-- Весь код отвечающий за спавн аномалий в игре и их размещение.
ПОДРОБНЕЕ ТУТ ---> mods\anomaly\code\spawn_anomalies_protocol\core_spawn_protocol.dm , в начале файла.

В общих чертах - разнообразые "Источники", такие как:
-Ивент "Разлив БСД", 
-Появление в мире большого артефакта подходящего по условиям 
-Диреликт,где мапер поставил аномалии 
-Планеты которые помечены как спавнящие аномалии
Собирают вокруг себя турфы и вызывают функцию generate_anomalies_in_turfs(), которая размещает аномалии по очень
примитивному алгоритму - случайным образом выбирает из переданного списка турфов турф и ставит аномалию. Если аномалия мультитайтловая, то при пересечении аномалии с чем-то, убирает турф из списка турфов, аномалию удаляют. Технически - метод тыка.


## Погода
Основная задача данного кода - реагировать на вход/выход ИГРОКА(Обязателен Ckey у жертвы) и выдавать ему на экран оверлей, если потребуется. Если хотите добавить данной "Погоде" спрайт - ознакомьтесь с кодом по пути mods\anomaly\code\monitor_effects\snow_monitor_effect.dm

Генерируется Погода при генерации аномалий на планете Лёд. Перепишу когда появится нужда в локальных участках погоды(Для условного диреликта в виде вулканической местности)


## Билдер аномалий
Работает точно так же как и все билдеры. Для добавления новой аномалии - добавьте её в список possible_anomalies по аналогии. Всё что идёт справа, от пути аномалии - её описание для администрации. Указывайте всю информацию, она может и БУДЕТ влиять на эффективность билдера.


## Сабсистема_аномалий


# WIP Документация в процессе написания! WIP
